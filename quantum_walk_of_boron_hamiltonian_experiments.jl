using LinearAlgebra, Images

function getRGBchannels(rgbimg)
    channels = channelview(rgbimg)
    redChannel = channels[1,:,:]
    greenChannel = channels[2,:,:]
    blueChannel = channels[3,:,:]
    return redChannel, greenChannel, blueChannel
end

H = [1.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.; 
     0.           1.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.;
     0.           0.              1.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            1.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            1.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
    0.           0.              0.            0.            0.             1.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.; 
     0.           0.              0.            0.            0.             0.           1.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.;
     0.           0.              0.            0.            0.             0.           0.              1.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            1.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            1.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
    0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           1.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        1.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              1.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            1.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            1. 0.           0.              0.            0.            0.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
    0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 1.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           1.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              1.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            1.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            1.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
    0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             -12.32108595  -3.18732952   0.           0.              0.            0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
    0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.            -3.18732952  -3.41246493     0.           0.            0.             0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;  
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.             -2.61755896   0.            0.             0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.             0.          -2.61755896    0.             0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.             0.           0.          -2.61755896      0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           1.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        1.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              1.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            1.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            1. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
    0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 1.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           1.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0.;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              1.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            1.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            1.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             1.           0.              0.            0.            0.           0.        0.              0.            0.            0.; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           1.              0.            0.            0.           0.        0.              0.            0.            0.;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              1.            0.            0.           0.        0.              0.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            1.            0.           0.        0.              0.            0.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            1.           0.        0.              0.            0.            0;
    0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           1.        0.              0.            0.            0.; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        1.              0.            0.            0.;
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              1.            0.            0;   
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            1.            0; 
     0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.              0.           0.              0.            0.            0.           0.        0.              0.            0.            0. 0.           0.              0.            0.            0.             0.           0.              0.            0.            0.           0.        0.              0.            0.            1;]



V = H

function walk(channel, time)
    U1 = exp(-1im*time*H)
    U2 = exp(-1im*time*V)
    temp = U1*channel*U2
    newimg = map(x -> minimum([1,x]), norm.(temp))
    return newimg
 end

function showNewImage(originalImage, time, rowLaplacian, columnLaplacian)
    channels = channelview(originalImage)
    rc = channels[1,:,:]
    gc = channels[2,:,:]
    bc = channels[3,:,:]
    newrc = walk(rc, time)
    newgc = walk(gc, time)
    newbc = walk(bc, time)
    nrows, ncols = size(rc)
    newimg = []
    for c in 1:ncols
        for r in 1:nrows
            push!(newimg,RGB{Float32}(newrc[r,c],newgc[r,c],newbc[r,c]))
        end
    end
    newimg = reshape(newimg, (nrows,ncols))
    return RGB{Float32}.(newimg)
end


function saveImages(img,numsteps;regularity = 2, basepath = "C:/Users/Student5/Desktop/Bitcoin Stuff/line_to_be_walked_on.png",grayScale = true)
    rc,gc,bc = getRGBchannels(img)
    if grayScale == true
        img0 = rc
    else
        img0 = img
    end
    for k=1:numsteps
        numberLabel = string(1000 + k,".png")[2:end]
        picName = string(basepath,numberLabel)
        if grayScale == true
            newimg = Gray.(walk(img0,k*pi/5))
            save(picName,newimg)
        else
            newimg = showNewImage( img0,k*pi/5)
            save(picName,newimg)
        end #grayscale test
    end #for loop
    return 
end

img0 = Images.load("C:/Users/Student5/Desktop/Bitcoin Stuff/line_to_be_walked_on.png")

rc,gc,bc = getRGBchannels(img0) #we chose redd channel rc since we want to view grey scale

saveImages(img0,20;regularity = 2, basepath = "C:/Users/Student5/Desktop/Bitcoin Stuff/line_to_be_walked_on.png",grayScale = true)
